define("metaserver/static/js/campaigns/api",["require","exports","tslib","metaserver/static/js/clean/active_user","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/core/exception"],(function(e,t,a,i,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBestCampaignsForUser=void 0,r=a.__importStar(r),t.getBestCampaignsForUser=function(e){if(!e.campaign_properties||0===Object.keys(e.campaign_properties).length)throw new Error("campaign_properties cannot be empty");const t=(0,i.mustGetActiveUser)();return new n.DefaultUserApiV2Client(t).ns("campaigns_toolkit").rpc("get_best_campaigns_for_user",e,{}).catch(t=>(r.reportException({err:t,tags:["fetchCampaigns","campaigns"],severity:r.SEVERITY.NONCRITICAL,exc_extra:{args:e}}),{campaigns:[],campaigns_to_slots:{}}))}})),define("metaserver/static/js/campaigns/campaign_events_api",["require","exports","tslib","react","metaserver/static/js/core/exception","metaserver/static/js/api_v2/user_client","metaserver/static/js/clean/active_user","metaserver/static/js/user_metadata/api"],(function(e,t,a,i,n,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignContext=t.parseIntOrUndefined=t.reportException=t.logCampaignControl=t.logCampaignDismissed=t.setCampaignDismissedInUserMetadata=t.getIsCampaignDismissedInUserMetadata=t.logCampaignClick=t.logCampaignImpressionDeclined=t.logCampaignImpression=t.createMegaphoneCampaignImpressionContextFromMegaphoneImpressionContext=t.createMegaphoneCampaignImpressionContext=t.createMegaphoneCampaignImpressionContextFromEnrichedCampaignImpressionContext=void 0,i=a.__importDefault(i),n=a.__importStar(n);function c(e,t,a){let i=void 0;try{i={campaignId:t,campaignVariantId:a,campaignImpressionId:e,userId:(0,s.mustGetActiveUserId)()}}catch(e){reportException({err:e})}return i}function reportException({err:e,severity:t=n.SEVERITY.NONCRITICAL,exc_extra:a={}}){n.reportException({err:e,tags:["megaphone","robe"],severity:t,exc_extra:a})}function m(e,t,a){const i=new r.UserApiV2Client,n={megaphone_impression_id:e.campaignImpressionId,megaphone_request_context:{user_id:e.userId},campaign_event_name:t,campaign_event_info:a,campaign_id:p(e.campaignId),version_id:p(e.campaignVariantId)};return i.ns("megaphone").rpc("log_campaign_event",n,{subjectUserId:e.userId}).catch(a=>{reportException({err:a,exc_extra:{user_id:e.userId,impression_id:e.campaignImpressionId,event_name:t[".tag"]}})})}function p(e){switch(typeof e){case"string":return parseInt(e,10);case"number":return e;default:return}}t.createMegaphoneCampaignImpressionContextFromEnrichedCampaignImpressionContext=function(e){var t,a;return c(e.megaphone_impression_id||"",null===(t=e.campaign_variant_descriptor)||void 0===t?void 0:t.campaign_id,null===(a=e.campaign_variant_descriptor)||void 0===a?void 0:a.variant_id)},t.createMegaphoneCampaignImpressionContext=c,t.createMegaphoneCampaignImpressionContextFromMegaphoneImpressionContext=function(e){var t,a,i,n;if(e.megaphone_impression_id)return c(e.megaphone_impression_id,null===(a=null===(t=e.version_info)||void 0===t?void 0:t.campaign_id)||void 0===a?void 0:a.toString(),null===(n=null===(i=e.version_info)||void 0===i?void 0:i.version_id)||void 0===n?void 0:n.toString())},t.logCampaignImpression=function(e){return m(e,{".tag":"impression"})},t.logCampaignImpressionDeclined=function(e){return m(e,{".tag":"impression_declined"})},t.logCampaignClick=function(e,t){return m(e,{".tag":"click"},{cta_id:t})},t.getIsCampaignDismissedInUserMetadata=function(e,t,i){return a.__awaiter(this,void 0,void 0,(function*(){if(e)try{const{CAMPAIGNS_TOOLKIT_USER_DISMISSED_CAMPAIGNS:t}=yield(0,o.getUserMetadata)(["CAMPAIGNS_TOOLKIT_USER_DISMISSED_CAMPAIGNS"],i);return!!t&&new Set(t.split(":")).has(`${e}`)}catch(a){return reportException({err:a,exc_extra:{user_id:i,impression_id:t,campaign_id:e,event_name:"getIsCampaignDismissedInUserMetadata"}}),!0}return!1}))},t.setCampaignDismissedInUserMetadata=function(e,t,i){return a.__awaiter(this,void 0,void 0,(function*(){if(e)try{const{CAMPAIGNS_TOOLKIT_USER_DISMISSED_CAMPAIGNS:t}=yield(0,o.getUserMetadata)(["CAMPAIGNS_TOOLKIT_USER_DISMISSED_CAMPAIGNS"],i),a=new Set(t?t.split(":"):"").add(`${e}`),n=Array.from(a).join(":");yield(0,o.setUserMetadata)({CAMPAIGNS_TOOLKIT_USER_DISMISSED_CAMPAIGNS:n},i)}catch(a){reportException({err:a,exc_extra:{user_id:i,impression_id:t,campaign_id:e,event_name:"setCampaignDismissedInUserMetadata"}})}}))},t.logCampaignDismissed=function(e){return m(e,{".tag":"dismissed"})},t.logCampaignControl=function(e){return m(e,{".tag":"control"})},t.reportException=reportException,t.parseIntOrUndefined=p,t.CampaignContext=i.default.createContext(void 0)})),define("metaserver/static/js/campaigns/campaign_hooks",["require","exports","react","metaserver/static/js/campaigns/campaign_events_api","metaserver/static/js/campaigns/emitter"],(function(e,t,a,i,n){"use strict";function r(e){(0,i.logCampaignImpression)(e)}function s(e){(0,i.logCampaignImpressionDeclined)(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.useCampaignDismissed=t.useCampaignClick=t.useCampaignAsync=t.useCampaign=void 0,t.useCampaign=function(e,t){(0,a.useEffect)(()=>{(null==e?void 0:e.campaignImpressionId)&&(t?s(e):r(e))},[])},t.useCampaignAsync=function(){return{onCampaignImpression:(0,a.useCallback)((function(e,t){e.campaignImpressionId&&(t?s(e):r(e))}),[])}},t.useCampaignClick=function(e,t){return{onCampaignClickCallback:(0,a.useCallback)((function(){(null==e?void 0:e.campaignImpressionId)&&(0,i.logCampaignClick)(e,t)}),[e,t])}},t.useCampaignDismissed=function(e){return{onCampaignDismissedCallback:(0,a.useCallback)((function(){(null==e?void 0:e.campaignId)&&(0,n.emitCampaignDismissed)(null==e?void 0:e.campaignId),(null==e?void 0:e.campaignImpressionId)&&((0,i.logCampaignDismissed)(e),(0,i.setCampaignDismissedInUserMetadata)(null==e?void 0:e.campaignId,null==e?void 0:e.campaignImpressionId,null==e?void 0:e.userId))}),[e])}}}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};define("metaserver/static/js/campaigns/campaign_formats/banner/loadable_banner",["require","exports","metaserver/static/js/async/loadable"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCampaignBanner=void 0,t.AsyncCampaignBanner=(0,a.Loadable)({loader:()=>new Promise((t,a)=>{e(["metaserver/static/js/campaigns/campaign_formats/banner/banner"],t,a)}).then(__importStar).then(({CampaignBanner:e})=>e)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};define("metaserver/static/js/campaigns/campaign_formats/banner/loadable_campaign_banner",["require","exports","metaserver/static/js/async/loadable"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCampaignBanner=void 0,t.AsyncCampaignBanner=(0,a.Loadable)({loader:()=>new Promise((t,a)=>{e(["metaserver/static/js/campaigns/campaign_formats/banner/campaign_banner"],t,a)}).then(__importStar).then(({CampaignBannerConversionComponent:e})=>e)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};define("metaserver/static/js/campaigns/campaign_formats/dialog/loadable_campaign_dialog",["require","exports","metaserver/static/js/async/loadable"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCampaignDialog=void 0,t.AsyncCampaignDialog=(0,a.Loadable)({loader:()=>new Promise((t,a)=>{e(["metaserver/static/js/campaigns/campaign_formats/dialog/campaign_dialog"],t,a)}).then(__importStar).then(({CampaignDialogConversionComponent:e})=>e)})})),define("metaserver/static/js/campaigns/campaign_formats/index",["require","exports","tslib","react","metaserver/static/js/campaigns/campaign_formats/banner/loadable_banner","metaserver/static/js/campaigns/emitter","metaserver/static/js/campaigns/types","metaserver/static/js/campaigns/utils","metaserver/static/js/campaigns/errors"],(function(e,t,a,i,n,r,s,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignFormatWithListener=t.CampaignFormat=t.CAMPAIGN_FORMATS=void 0,i=a.__importStar(i),t.CAMPAIGN_FORMATS={[s.CampaignFormats.BANNER]:n.AsyncCampaignBanner};t.CampaignFormat=({allowedComponents:e,impression:a})=>{var n,r,s,m;const p=null===(r=null===(n=a.campaign_variant_descriptor)||void 0===n?void 0:n.variant_content)||void 0===r?void 0:r.format,l=t.CAMPAIGN_FORMATS[p],g=(0,o.checkForRequiredKeysInContentDictionary)(a);if(!e.includes(p)||!l||!g)return(0,c.logCampaignFormatFailedRenderError)(new c.CampaignFormatFailedRenderError(e.includes(p)?null:p||"undefined",l?null:p||"undefined",!g)),null;const _=null===(m=null===(s=a.campaign_variant_descriptor)||void 0===s?void 0:s.variant_content)||void 0===m?void 0:m.container;if(_){const e={"data-testid":"campaign-format-container"};return i.default.createElement(_.tag||"div",Object.assign(Object.assign({},e),_.props),i.default.createElement(l,Object.assign({},a)))}return i.default.createElement(l,Object.assign({},a))};t.CampaignFormatWithListener=({allowedComponents:e,slotId:a})=>{const[n,s]=(0,i.useState)();return(0,i.useEffect)(()=>(r.campaignsEmitter.on(a,s),()=>{r.campaignsEmitter.off(a)}),[]),n?i.default.createElement(t.CampaignFormat,Object.assign({},{allowedComponents:e,impression:n})):null}})),define("metaserver/static/js/campaigns/campaign_formats/index_new",["require","exports","tslib","react","metaserver/static/js/campaigns/emitter","metaserver/static/js/campaigns/filters/index","metaserver/static/js/campaigns/history_utils","metaserver/static/js/campaigns/campaign_formats/banner/loadable_campaign_banner","metaserver/static/js/campaigns/campaign_formats/menu/loadable_campaign_menu_item","metaserver/static/js/campaigns/campaign_formats/modal/loadable_campaign_modal","metaserver/static/js/campaigns/campaign_formats/snackbar/loadable_campaign_snackbar","metaserver/static/js/campaigns/campaign_formats/tooltip/loadable_campaign_tooltip","metaserver/static/js/campaigns/campaign_formats/dialog/loadable_campaign_dialog"],(function(e,t,a,i,n,r,s,o,c,m,p,l,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignSlot=t.shouldCampaignRender=t.preloadCampaign=t.CampaignFormat=void 0,i=a.__importStar(i);t.CampaignFormat=e=>{var t,a;const n=e.currentSequenceStep;let r=void 0;if(n){const i=null===(a=null===(t=e.campaign.sequence)||void 0===t?void 0:t.nodes)||void 0===a?void 0:a[n];i&&(r=i.content)}else r=e.campaign.content;const s=Object.assign(Object.assign({},e),{activeCampaignContent:r}),_=null==r?void 0:r[".tag"];if(!_)return null;const u=`${e.campaign.campaign_id}-${n}`;switch(_){case"banner_campaign_format":return i.default.createElement(o.AsyncCampaignBanner,Object.assign({key:u},s));case"menu_item_campaign_format":return i.default.createElement(c.AsyncCampaignMenuItem,Object.assign({key:u},s));case"snackbar_campaign_format":return i.default.createElement(p.AsyncCampaignSnackbar,Object.assign({key:u},s));case"modal_campaign_format":return i.default.createElement(m.AsyncCampaignModal,Object.assign({key:u},s));case"tooltip_campaign_format":return i.default.createElement(l.AsyncCampaignTooltip,Object.assign({key:u},s));case"dialog_campaign_format":return i.default.createElement(g.AsyncCampaignDialog,Object.assign({key:u},s));default:return null}};t.preloadCampaign=e=>{var t;const a=(0,s.getEvents)(e);if(a&&a.length>0){const{data:e,context:i}=a[a.length-1],n=(0,r.getFiltersForCampaign)(null===(t=e.campaign)||void 0===t?void 0:t.campaign.campaign_id);return{campaignProps:e.campaign,contextData:i,filters:n}}return{}};t.shouldCampaignRender=(e,t,a)=>{var i;if(!t)return!1;if(!(null==e?void 0:e.length))return!0;if(t.currentSequenceStep&&t.currentSequenceStep!==(null===(i=t.campaign.sequence)||void 0===i?void 0:i.root))return!0;const n={campaignProps:t,contextData:a};return e.every(e=>e(n))};t.CampaignSlot=({slotId:e,initialState:a={campaignProps:void 0,contextData:void 0,filters:void 0,loggingParams:void 0}})=>{const[{campaignProps:s,contextData:o,filters:c,loggingParams:m},p]=(0,i.useState)(a),l=(0,i.useMemo)(()=>(0,t.shouldCampaignRender)(c,s,o),[s,o,c]);if((0,i.useEffect)(()=>{const t=({data:e}={data:{}})=>{var t;const a=(0,r.getFiltersForCampaign)(null===(t=null==e?void 0:e.campaign)||void 0===t?void 0:t.campaign.campaign_id);p({campaignProps:(null==e?void 0:e.campaign)||s,contextData:(null==e?void 0:e.context)||o,filters:a||c,loggingParams:(null==e?void 0:e.loggingParams)||m})};return n.campaignsEmitter.on(e,t),()=>{n.campaignsEmitter.off(e,t)}},[]),s&&l){const e=Object.assign(Object.assign({},s),{contextData:o,loggingParams:m});return i.default.createElement(t.CampaignFormat,Object.assign({},e))}return null},t.CampaignSlot.displayName="CampaignSlot"}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};define("metaserver/static/js/campaigns/campaign_formats/menu/loadable_campaign_menu_item",["require","exports","metaserver/static/js/async/loadable"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCampaignMenuItem=void 0,t.AsyncCampaignMenuItem=(0,a.Loadable)({loader:()=>new Promise((t,a)=>{e(["metaserver/static/js/campaigns/campaign_formats/menu/campaign_menu_item"],t,a)}).then(__importStar).then(({CampaignMenuItemConversionComponent:e})=>e)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};define("metaserver/static/js/campaigns/campaign_formats/snackbar/loadable_campaign_snackbar",["require","exports","metaserver/static/js/async/loadable"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCampaignSnackbar=void 0,t.AsyncCampaignSnackbar=(0,a.Loadable)({loader:()=>new Promise((t,a)=>{e(["metaserver/static/js/campaigns/campaign_formats/snackbar/campaign_snackbar"],t,a)}).then(__importStar).then(({CampaignSnackbarConversionComponent:e})=>e)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};define("metaserver/static/js/campaigns/campaign_formats/modal/loadable_campaign_modal",["require","exports","metaserver/static/js/async/loadable"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCampaignModal=void 0,t.AsyncCampaignModal=(0,a.Loadable)({loader:()=>new Promise((t,a)=>{e(["metaserver/static/js/campaigns/campaign_formats/modal/campaign_modal"],t,a)}).then(__importStar).then(({CampaignModalConversionComponent:e})=>e)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t};define("metaserver/static/js/campaigns/campaign_formats/tooltip/loadable_campaign_tooltip",["require","exports","metaserver/static/js/async/loadable"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCampaignTooltip=void 0,t.AsyncCampaignTooltip=(0,a.Loadable)({loader:()=>new Promise((t,a)=>{e(["metaserver/static/js/campaigns/campaign_formats/tooltip/campaign_tooltip"],t,a)}).then(__importStar).then(({CampaignTooltip:e})=>e)})})),define("metaserver/static/js/campaigns/emitter",["require","exports","tslib","eventemitter3"],(function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.publishEvent=t.emitCampaignSequenceAction=t.emitPageLoaded=t.emitCampaignDismissed=t.emitCampaignToSlot=t.getSlotFromCampaignFormatProps=t.getSlotFromImpression=t.campaignsEmitter=t.CampaignsEventEmitter=t.CAMPAIGN_SEQUENCE_ACTION=t.CAMPAIGN_EVENT=t.PAGE_LOADED=t.CAMPAIGN_DISMISSED=void 0,i=a.__importDefault(i),t.CAMPAIGN_DISMISSED="campaign-dismissed",t.PAGE_LOADED="page-loaded",t.CAMPAIGN_EVENT="campaign-event",t.CAMPAIGN_SEQUENCE_ACTION="sequence-action";class n extends i.default{constructor(){super(),this.allEventBuffers={}}on(e,t){super.on(e,t);const a=this.allEventBuffers[e.toString()];return void 0!==a&&a.forEach(t=>{super.emit(e,t)}),this}emit(e,t){return t&&"object"==typeof t&&"name"in t&&(void 0===this.allEventBuffers[t.name]&&(this.allEventBuffers[t.name]=[]),this.allEventBuffers[t.name].push(t)),super.emit(e,t)}}t.CampaignsEventEmitter=n,t.campaignsEmitter=new n;t.getSlotFromImpression=e=>{var t,a,i;return null===(i=null===(a=null===(t=null==e?void 0:e.campaign_variant_descriptor)||void 0===t?void 0:t.variant_content)||void 0===a?void 0:a.slot)||void 0===i?void 0:i[".tag"]};t.getSlotFromCampaignFormatProps=e=>{var t;return null===(t=null==e?void 0:e.slotId)||void 0===t?void 0:t[".tag"]};t.emitCampaignToSlot=(e,a,i)=>{const n=(0,t.getSlotFromCampaignFormatProps)(e);n&&"other"!==n&&t.campaignsEmitter.emit(n,{name:n,data:{campaign:e,context:a,loggingParams:i}})};t.emitCampaignDismissed=e=>{t.campaignsEmitter.emit(t.CAMPAIGN_DISMISSED,e)};t.emitPageLoaded=(e,a)=>{t.campaignsEmitter.emit(t.PAGE_LOADED,{name:t.PAGE_LOADED,data:{page:e,context:a}})};t.emitCampaignSequenceAction=(e,a)=>{t.campaignsEmitter.emit(t.CAMPAIGN_SEQUENCE_ACTION,{campaignId:e,ctaId:a})};t.publishEvent=(e,a={})=>{t.campaignsEmitter.emit(t.CAMPAIGN_EVENT,{name:e,data:a})}})),define("metaserver/static/js/campaigns/errors",["require","exports","tslib","metaserver/static/js/core/exception"],(function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logCampaignFormatFailedRenderError=t.CampaignFormatFailedRenderError=t.logCampaignFormatMissingRequiredContentError=t.CampaignFormatMissingRequiredContentError=void 0,i=a.__importStar(i);class n extends Error{constructor(e,t){super("The following required properties are missing from the content dictionary for the "+e+" format: "+t.join(", ")),Object.setPrototypeOf(this,n.prototype)}}t.CampaignFormatMissingRequiredContentError=n,t.logCampaignFormatMissingRequiredContentError=function(e){i.reportException({err:e,severity:i.SEVERITY.NONCRITICAL,tags:["campaigns","toolkit","missing","required","properties"]})};class r extends Error{constructor(e,t,a){super((null==e?"":`The format: ${e} is not allowed `)+(null==t?"":`There is no matching format component for: ${t} `)+(a?"":"Required keys are missing")),Object.setPrototypeOf(this,r.prototype)}}t.CampaignFormatFailedRenderError=r,t.logCampaignFormatFailedRenderError=function(e){i.reportException({err:e,severity:i.SEVERITY.NONCRITICAL,tags:["campaigns","toolkit","FormatFailedRender"]})}})),define("metaserver/static/js/campaigns/filters/index",["require","exports","metaserver/static/js/campaigns/filters/backup_filters","metaserver/static/js/campaigns/filters/constants","metaserver/static/js/campaigns/filters/shop_filters"],(function(e,t,a,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFiltersForCampaign=t.CAMPAIGNS_TO_FILTERS=void 0,t.CAMPAIGNS_TO_FILTERS={[i.SHOP_MENU_ITEM_CAMPAIGN_ID]:[n.isScreenSizeSupportedForShopCampaigns,n.checkSelectedFilesShopEligibility,n.qualifyShopByVersionId],[i.SHOP_MENU_ITEM_CAMPAIGN_ID_TEST]:[n.isScreenSizeSupportedForShopCampaigns,n.checkSelectedFilesShopEligibility],[i.SHOP_MODAL_CAMPAIGN_ID]:[n.isScreenSizeSupportedForShopCampaigns,n.hasOpenedShareSettings,n.checkSelectedFilesShopEligibility,n.qualifyShopByVersionId],[i.SHOP_MODAL_CAMPAIGN_ID_TEST]:[n.isScreenSizeSupportedForShopCampaigns,n.hasOpenedShareSettings,n.checkSelectedFilesShopEligibility],[i.BACKUP_SURFACE_DISCOVERABILITY_SEQUENCE_CAMPAIGN_ID]:[a.qualifyBackupSurfaceDiscoverabilityByVersionId],[i.BACKUP_SURFACE_DISCOVERABILITY_CONTROL_CAMPAIGN_ID]:[a.qualifyBackupSurfaceDiscoverabilityByVersionId]},t.getFiltersForCampaign=function(e=-1){return t.CAMPAIGNS_TO_FILTERS[e]||[]}})),define("metaserver/static/js/campaigns/filters/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SHOP_MODAL_TEST=t.SHOP_MODAL_CAMPAIGN_ID_TEST=t.SHOP_MENU_ITEM_TEST=t.SHOP_MENU_ITEM_CAMPAIGN_ID_TEST=t.BACKUP_SURFACE_DISCOVERABILITY_CONTROL=t.BACKUP_SURFACE_DISCOVERABILITY_V1=t.BACKUP_SURFACE_DISCOVERABILITY_CONTROL_CAMPAIGN_ID=t.BACKUP_SURFACE_DISCOVERABILITY_SEQUENCE_CAMPAIGN_ID=t.SHOP_MODAL_CONTROL=t.SHOP_MODAL_V1=t.SHOP_MODAL_CAMPAIGN_ID=t.SHOP_MENU_ITEM_CONTROL=t.SHOP_MENU_ITEM_V1=t.SHOP_MENU_ITEM_CAMPAIGN_ID=void 0,t.SHOP_MENU_ITEM_CAMPAIGN_ID=6014,t.SHOP_MENU_ITEM_V1=13826,t.SHOP_MENU_ITEM_CONTROL=13827,t.SHOP_MODAL_CAMPAIGN_ID=6113,t.SHOP_MODAL_V1=13981,t.SHOP_MODAL_CONTROL=13980,t.BACKUP_SURFACE_DISCOVERABILITY_SEQUENCE_CAMPAIGN_ID=6668,t.BACKUP_SURFACE_DISCOVERABILITY_CONTROL_CAMPAIGN_ID=6669,t.BACKUP_SURFACE_DISCOVERABILITY_V1=14662,t.BACKUP_SURFACE_DISCOVERABILITY_CONTROL=14663,t.SHOP_MENU_ITEM_CAMPAIGN_ID_TEST=5921,t.SHOP_MENU_ITEM_TEST=13789,t.SHOP_MODAL_CAMPAIGN_ID_TEST=6119,t.SHOP_MODAL_TEST=13970})),define("metaserver/static/js/campaigns/filters/shop_filters",["require","exports","metaserver/static/js/campaigns/filters/constants","metaserver/static/js/campaigns/types","metaserver/static/js/onboarding/logging/events","metaserver/static/js/onboarding/logging/logging","metaserver/static/js/campaigns/history_utils"],(function(e,t,a,i,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isScreenSizeSupportedForShopCampaigns=t.hasOpenedShareSettings=t.qualifyShopByVersionId=t.checkSelectedFilesShopEligibility=void 0;const o=["bmp","cr2","gif","ico","ithmb","jpeg","jpg","nef","png","raw","svg","tif","tiff","wbmp","webp","aac","aif","aifc","aiff","au","flac","m4a","mid","mp3","m4b","m4p","m4r","oga","ogg","opus","ra","ram","spx","wav","wm","3gp","3gpp","3gpp2","3g2","asf","avi","dv","dvi","flv","m2t","mp4","m4v","mkv","mov","mpeg","mpg","mts","ogv","ogx","rm","rmvb","ts","vob","webm","wm","pdf"];t.checkSelectedFilesShopEligibility=({contextData:e})=>Object.keys(e.fileExts).every(e=>o.includes(e));t.qualifyShopByVersionId=({campaignProps:e,contextData:t})=>{const{campaign_id:i,version_id:s}=e.campaign,{fileExts:o,referrer:c}=t;let m="UNKNOWN";return i===a.SHOP_MENU_ITEM_CAMPAIGN_ID?s===a.SHOP_MENU_ITEM_V1?m="V1":s===a.SHOP_MENU_ITEM_CONTROL&&(m="CONTROL"):i===a.SHOP_MODAL_CAMPAIGN_ID&&(s===a.SHOP_MODAL_V1?m="V1":s===a.SHOP_MODAL_CONTROL&&(m="CONTROL")),t.shouldLogQualifyEvent&&r.OALogger.logToProEvents(n.ShopEntryPointEvents.SHOP_ENTRY_POINT_QUALIFY,{experiment:"core_act_shop_entry_point",location:c,file_exts:o,campaignId:i,versionId:s,variantName:m}),"V1"===m};t.hasOpenedShareSettings=({contextData:e})=>{const t=(0,s.hasEventInHistory)(i.CampaignEvents.SHARE_MODAL_SETTINGS_OPENED,e);return t&&(0,s.removeEventFromHistory)(i.CampaignEvents.SHARE_MODAL_SETTINGS_OPENED,e),t};t.isScreenSizeSupportedForShopCampaigns=()=>screen.availWidth>=625||screen.availHeight>=570})),define("metaserver/static/js/campaigns/filters/backup_filters",["require","exports","lodash","metaserver/static/js/campaigns/filters/constants","metaserver/static/js/campaigns/utils/logging","metaserver/static/js/onboarding/logging/events","metaserver/static/js/onboarding/logging/logging"],(function(e,t,a,i,n,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qualifyBackupSurfaceDiscoverabilityByVersionId=void 0;const o=(0,a.once)(n.logCampaignDismissEvent);t.qualifyBackupSurfaceDiscoverabilityByVersionId=({campaignProps:e})=>{const{campaign_id:t,version_id:a}=e.campaign;let n="UNKNOWN";return t===i.BACKUP_SURFACE_DISCOVERABILITY_SEQUENCE_CAMPAIGN_ID?n="V1":t===i.BACKUP_SURFACE_DISCOVERABILITY_CONTROL_CAMPAIGN_ID&&(n="CONTROL",o(r.CampaignsToolkitEvents.CAMPAIGN_DISMISS,e)),s.OALogger.logToProEvents(r.BackupSurfaceDiscoverabilityEvents.BACKUP_SURFACE_DISCOVERABILITY_QUALIFY,{experiment:"core_act_backup_surface_discoverability",campaignId:t,versionId:a,variantName:n}),"V1"===n}})),define("metaserver/static/js/campaigns/history_utils",["require","exports","lodash","metaserver/static/js/campaigns/emitter"],(function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeEventFromHistory=t.resetHistoryForEvent=t.hasEventInHistory=t.getHistoryForEvent=t.getEvents=t.getEventBuffers=t.filterOutEvent=t.filterForEvent=void 0;const n=(e={},t={})=>Object.entries(t).every(([t,i])=>(0,a.isEqual)(e[t],i));t.filterForEvent=(e,t)=>e.filter(({data:e})=>n(null==e?void 0:e.context,t));t.filterOutEvent=(e,t)=>e.filter(({data:e})=>!n(null==e?void 0:e.context,t));t.getEventBuffers=()=>i.campaignsEmitter.allEventBuffers;t.getEvents=(e=null)=>e?(0,t.getEventBuffers)()[e]||[]:(0,a.flatten)(Object.values((0,t.getEventBuffers)()));t.getHistoryForEvent=(e,a=null)=>{const i=(0,t.getEvents)(e);return a&&i.length?(0,t.filterForEvent)(i,a):i};t.hasEventInHistory=(e,a)=>!!(0,t.filterForEvent)((0,t.getEvents)(e),a).length;t.resetHistoryForEvent=e=>{i.campaignsEmitter.allEventBuffers[e]=[]};t.removeEventFromHistory=(e,a)=>{if((0,t.getEventBuffers)()[e])return a?void(i.campaignsEmitter.allEventBuffers[e]=(0,t.filterOutEvent)((0,t.getEventBuffers)()[e],a)):(0,t.resetHistoryForEvent)(e)}})),define("metaserver/static/js/campaigns/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignEvents=t.ActionHandlers=t.PromptLoggingEvents=t.CampaignFormats=void 0,(function(e){e.BANNER="banner"})(t.CampaignFormats||(t.CampaignFormats={})),(function(e){e.CONFIRM="confirm",e.DISMISS="dismiss",e.SHOW="show"})(t.PromptLoggingEvents||(t.PromptLoggingEvents={})),(function(e){e.CLICK_ELEMENT_FROM_CSS_SELECTOR="click_element_from_css_selector",e.LAUNCH_URL_IN_NEW_TAB="launch_url_in_new_tab",e.OPEN_URL_IN_NEW_TAB="open_url_in_new_tab"})(t.ActionHandlers||(t.ActionHandlers={})),(function(e){e.SHARE_MODAL_CLOSED="share_modal_closed",e.SHARE_MODAL_SETTINGS_OPENED="share_modal_settings_opened",e.FILE_UPLOAD_FAILURE="file_upload_failure_overquota"})(t.CampaignEvents||(t.CampaignEvents={}))})),define("metaserver/static/js/campaigns/utils",["require","exports","metaserver/static/js/campaigns/errors","metaserver/static/js/campaigns/types"],(function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleCampaignMenuSelection=t.checkForRequiredKeysInContentDictionary=t.requiredPropMapping=void 0,t.requiredPropMapping={[i.CampaignFormats.BANNER]:["message","cta_button_text","on_cta_button_click"]},t.checkForRequiredKeysInContentDictionary=function(e){var i,n,r,s;const o=null===(n=null===(i=e.campaign_variant_descriptor)||void 0===i?void 0:i.variant_content)||void 0===n?void 0:n.format,c=(null===(s=null===(r=e.campaign_variant_descriptor)||void 0===r?void 0:r.variant_content)||void 0===s?void 0:s.content)||{},m=t.requiredPropMapping[o]||[];for(const e of m)if(!(e in c))return(0,a.logCampaignFormatMissingRequiredContentError)(new a.CampaignFormatMissingRequiredContentError(o||"",m.filter(e=>!c[e]))),!1;return!0};t.handleCampaignMenuSelection=(e,t,a)=>{if(e.hasOwnProperty("campaignHandler"))return e.campaignHandler(t);a(e)}})),define("metaserver/static/js/campaigns/utils/logging",["require","exports","metaserver/static/js/campaigns/types","metaserver/static/js/campaigns/utils/prompt_logger","metaserver/static/js/onboarding/logging/logging"],(function(e,t,a,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logCampaignClientDispatchedEvent=t.logCampaignSequenceEvent=t.logCampaignImpressionEvent=t.logCampaignDismissEvent=t.logCampaignConfirmEvent=void 0;const r=(e,t,a)=>{const{campaign_id:i,version_id:r}=t.campaign;n.OALogger.logToProEvents(e,Object.assign(Object.assign({},a),{campaignId:i,versionId:r}))},s=(e,t,a,n)=>{r(e,t,n),(0,i.logToPrompt)(a,t)};t.logCampaignConfirmEvent=(e,t,i,n)=>{t&&s(e,t,a.PromptLoggingEvents.CONFIRM,Object.assign({ctaId:i},n))};t.logCampaignDismissEvent=(e,t,i)=>{t&&s(e,t,a.PromptLoggingEvents.DISMISS,i)};t.logCampaignImpressionEvent=(e,t,i)=>{t&&s(e,t,a.PromptLoggingEvents.SHOW,i)};t.logCampaignSequenceEvent=(e,t,a,i)=>{r(e,t,{currentSequenceStep:a,ctaId:i})};t.logCampaignClientDispatchedEvent=(e,t,a)=>{r(e,t,a)}})),define("metaserver/static/js/campaigns/utils/prompt_logger",["require","exports","tslib","metaserver/static/js/campaigns/types","metaserver/static/js/deprecated_ajax/ajax","metaserver/static/js/core/uri"],(function(e,t,a,i,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logToPrompt=void 0,n=a.__importStar(n);t.logToPrompt=(e,t)=>{const a=(e=>{switch(e){case i.PromptLoggingEvents.SHOW:return"/prompt/log_impression";case i.PromptLoggingEvents.CONFIRM:return"/prompt/confirm";case i.PromptLoggingEvents.DISMISS:return"/prompt/dismiss";default:return""}})(e);if(!a)return;const s=((e,t)=>{const{campaign:a}=t,i={campaign_id:a.campaign_id.toString()};if(a.version_id&&(i.version_id=a.version_id.toString()),"number"==typeof a.prompt_queried_at_ms&&(i.prompt_queried_at_ms=a.prompt_queried_at_ms.toString()),window&&window.performance&&window.performance.now){const e=Math.round(window.performance.now());i.delta_from_request_start_ms=e.toString()}return a.matched_user_id&&(i._subject_uid=String(a.matched_user_id)),t.requestId&&(i.prompt_parent_request_id=t.requestId),new r.URI({path:e,query:i})})(a,t);n.SilentBackgroundRequest({url:s.toString()})}}));
//# sourceMappingURL=pkg-campaigns_toolkit.min.js-vfl_4vSK0.map